#!/bin/bash

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ git hooks –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
# JTBD: –ö–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ git hooks, —è —Ö–æ—á—É –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
# –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ, —á—Ç–æ–±—ã –∫–æ–¥ –≤—Å–µ–≥–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º.

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ git hooks –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞..."

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è hooks –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
mkdir -p .git/hooks

# –ö–æ–ø–∏—Ä—É–µ–º pre-commit hook
if [ -f ".githooks/pre-commit" ]; then
    cp .githooks/pre-commit .git/hooks/pre-commit
    chmod +x .git/hooks/pre-commit
    echo "‚úÖ Pre-commit hook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ùå –§–∞–π–ª .githooks/pre-commit –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º pre-commit –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
if ! command -v pre-commit &> /dev/null; then
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit..."
    pip install pre-commit
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º pre-commit hooks
echo "üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit hooks..."
pre-commit install

echo "‚úÖ Git hooks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
echo ""
echo "üéØ –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:"
echo "   - –ò—Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞"
echo "   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–æ–¥"
echo "   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞"
echo ""
echo "üí° –î–ª—è —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "   make auto-fix"
echo "   –∏–ª–∏"
echo "   python scripts/fix_linter_errors.py"
