# Документация по системе триггеров и вывода сообщений

## Обзор изменений

Мы внесли следующие улучшения в систему триггеров:

1. **Исправлены URL-адреса**: изменен формат URL с `localhost:5000` на `0.0.0.0:5000` для всех типов документов
2. **Улучшено извлечение данных**:
   - Реализована корректная обработка 5-почему анализа для инцидентов
   - Доработан алгоритм извлечения RAT-анализа и критерия фальсифицируемости для гипотез
3. **Протестированы все типы триггеров**:
   - Задачи
   - Инциденты
   - Гипотезы
   - Стандарты

## Интеграция с чатом

### Текущий механизм

Система триггеров использует функцию `report_progress({"summary": message})` для отправки сообщений в чат:

```python
# В обработчике триггера
if self.report_progress_func:
    self.report_progress_func({"summary": message})
```

### Проблемы с отображением

В текущей реализации эти сообщения могут не отображаться в чате из-за одной из следующих причин:

1. Несовместимость интерфейса сообщений с фронтендом чата
2. Блокировка сообщений системой
3. Асинхронная природа вызовов, из-за которой сообщения не успевают отобразиться

## Предложения по улучшению

### Альтернативные методы вывода

1. **Логирование в файл**:
   - Все триггеры могут записывать сообщения в специальный лог-файл
   - Веб-интерфейс может отображать содержимое этого файла

2. **API-эндпоинт для сообщений**:
   - Создать специальный API-эндпоинт для получения последних сообщений
   - Фронтенд может периодически опрашивать этот эндпоинт

3. **Веб-сокеты**:
   - Реализовать систему реального времени через веб-сокеты
   - Мгновенная доставка сообщений без необходимости обновления страницы

## Использование улучшенной системы триггеров

Несмотря на проблемы с отображением сообщений в чате, внесенные улучшения гарантируют, что:

1. Все URL-адреса сформированы корректно и ведут на правильные страницы в веб-интерфейсе
2. Извлекаются и обрабатываются все важные элементы документов
3. Система триггеров работает стабильно, что подтверждается тестами и логами

Для просмотра созданных документов можно использовать веб-интерфейс, доступный по адресу: `http://0.0.0.0:5000/`