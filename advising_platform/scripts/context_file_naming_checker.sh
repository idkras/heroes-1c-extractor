#!/bin/bash
# context_file_naming_checker.sh
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏–º–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
# created: 12 May 2025 by AI Assistant
# based on: Context Naming Standard 3.5

echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è..."
echo "======================================================================"

# –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
context_files=$(find ./projects -name "*context*.md" | grep -v "archive" | grep -v "md~")

# –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
count_total=0
count_incorrect=0
count_with_duplicates=0
projects_with_duplicates=()

for file in $context_files; do
  ((count_total++))
  dir=$(dirname "$file")
  name=$(basename "$file")
  project=$(basename "$dir")
  
  echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞: $file"
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏–º–µ–Ω–∏
  if [[ ! $name =~ ^[a-z0-9.-]+\ context\.md$ ]]; then
    ((count_incorrect++))
    echo "  ‚ö†Ô∏è –û–®–ò–ë–ö–ê: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏"
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π
    if [[ $name =~ [A-Z] ]]; then
      echo "    - –°–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã"
    fi
    
    if [[ ! $name =~ \ context\.md$ ]]; then
      echo "    - –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç 'context.md' —á–∞—Å—Ç–∏"
    fi
    
    if [[ $name =~ _context ]]; then
      echo "    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ø—Ä–æ–±–µ–ª–∞"
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø—Ä–æ–µ–∫—Ç –≤–µ–±-—Å–∞–π—Ç–æ–º
    if [[ $project =~ \. ]]; then
      # –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—á–∫—É, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ —ç—Ç–æ –¥–æ–º–µ–Ω
      if [[ ! $name =~ ^$project\ context\.md ]]; then
        echo "    - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–º–µ–Ω–∏ –ø–∞–ø–∫–∏ '$project'"
      fi
    fi
    
    echo "    ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏–º—è: '$project context.md'"
  else
    echo "  ‚úÖ –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É"
  fi
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
  duplicates=$(find "$dir" -name "*context*.md" | grep -v "archive" | grep -v "md~" | wc -l)
  if [ $duplicates -gt 1 ]; then
    ((count_with_duplicates++))
    projects_with_duplicates+=("$project")
    echo "  ‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ $dir:"
    find "$dir" -name "*context*.md" | grep -v "archive" | grep -v "md~" | sed 's/^/    - /'
    echo "    –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –æ–¥–∏–Ω –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è"
  fi
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ
  echo "  –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö..."
  has_updated=$(grep -l "updated:" "$file")
  has_based_on=$(grep -l "based on:" "$file")
  
  if [ -z "$has_updated" ]; then
    echo "    ‚ö†Ô∏è –û–®–ò–ë–ö–ê: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–æ–∫–∞ 'updated:'"
  else
    echo "    ‚úÖ –°—Ç—Ä–æ–∫–∞ 'updated:' –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
  fi
  
  if [ -z "$has_based_on" ]; then
    echo "    ‚ö†Ô∏è –û–®–ò–ë–ö–ê: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–æ–∫–∞ 'based on:'"
  else
    echo "    ‚úÖ –°—Ç—Ä–æ–∫–∞ 'based on:' –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
  fi
  
  echo ""
done

# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
echo "======================================================================"
echo "–ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢:"
echo "--------------------------------------------------------------------"
echo "–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: $count_total"
echo "–§–∞–π–ª–æ–≤ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏: $count_incorrect"
echo "–ü—Ä–æ–µ–∫—Ç–æ–≤ —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏—Å—è —Ñ–∞–π–ª–∞–º–∏: $count_with_duplicates"

if [ $count_with_duplicates -gt 0 ]; then
  echo ""
  echo "–ü—Ä–æ–µ–∫—Ç—ã —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:"
  for project in "${projects_with_duplicates[@]}"; do
    echo "  - $project"
  done
fi

echo ""
if [ $count_incorrect -eq 0 ] && [ $count_with_duplicates -eq 0 ]; then
  echo "üéâ –í—Å–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è!"
else
  echo "‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (3.5)."
fi
echo "======================================================================"