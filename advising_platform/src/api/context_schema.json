{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Context Schema",
  "description": "Схема для передачи контекста из внешних источников (Slack, Telegram)",
  "type": "object",
  "required": ["project", "namespace", "version", "data"],
  "properties": {
    "project": {
      "type": "string",
      "description": "Идентификатор проекта, к которому относится контекст"
    },
    "namespace": {
      "type": "string",
      "description": "Пространство имен для контекста (например, 'meetings', 'client_feedback', 'tickets')"
    },
    "version": {
      "type": "string",
      "description": "Версия формата контекста"
    },
    "source": {
      "type": "string",
      "enum": ["slack", "telegram", "other"],
      "description": "Источник данных контекста"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Дата и время создания контекста (ISO 8601)"
    },
    "data": {
      "type": "object",
      "description": "Данные контекста, зависят от namespace",
      "oneOf": [
        { "$ref": "#/definitions/meetingContext" },
        { "$ref": "#/definitions/clientFeedbackContext" },
        { "$ref": "#/definitions/taskContext" },
        { "$ref": "#/definitions/incidentContext" },
        { "$ref": "#/definitions/genericContext" }
      ]
    }
  },
  "definitions": {
    "meetingContext": {
      "type": "object",
      "required": ["type", "participants", "summary"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["meeting"],
          "description": "Тип контекста - встреча"
        },
        "title": {
          "type": "string",
          "description": "Название встречи"
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "Дата и время встречи"
        },
        "duration": {
          "type": "integer",
          "description": "Продолжительность встречи в минутах"
        },
        "participants": {
          "type": "array",
          "description": "Участники встречи",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "role": { "type": "string" },
              "company": { "type": "string" }
            }
          }
        },
        "summary": {
          "type": "string",
          "description": "Краткое описание результатов встречи"
        },
        "decisions": {
          "type": "array",
          "description": "Принятые решения",
          "items": { "type": "string" }
        },
        "action_items": {
          "type": "array",
          "description": "Запланированные действия",
          "items": {
            "type": "object",
            "properties": {
              "description": { "type": "string" },
              "assignee": { "type": "string" },
              "due_date": { "type": "string", "format": "date" }
            }
          }
        },
        "transcript": {
          "type": "string",
          "description": "Транскрипция или расширенные заметки встречи"
        }
      }
    },
    "clientFeedbackContext": {
      "type": "object",
      "required": ["type", "client", "feedback"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["client_feedback"],
          "description": "Тип контекста - обратная связь от клиента"
        },
        "client": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "company": { "type": "string" },
            "contact": { "type": "string" }
          }
        },
        "feedback": {
          "type": "string",
          "description": "Текст обратной связи"
        },
        "rating": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "Оценка от клиента (1-10)"
        },
        "sentiment": {
          "type": "string",
          "enum": ["positive", "neutral", "negative"],
          "description": "Общий тон обратной связи"
        },
        "areas": {
          "type": "array",
          "description": "Затронутые области",
          "items": { "type": "string" }
        },
        "suggestions": {
          "type": "array",
          "description": "Предложения по улучшению",
          "items": { "type": "string" }
        }
      }
    },
    "taskContext": {
      "type": "object",
      "required": ["type", "title", "priority"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["task"],
          "description": "Тип контекста - задача"
        },
        "title": {
          "type": "string",
          "description": "Название задачи"
        },
        "description": {
          "type": "string",
          "description": "Подробное описание задачи"
        },
        "priority": {
          "type": "string",
          "enum": ["ALARM", "ASAP", "BLOCKER", "RESEARCH", "SMALL TASK", "EXCITER"],
          "description": "Приоритет задачи"
        },
        "assignee": {
          "type": "string",
          "description": "Ответственный за выполнение"
        },
        "due_date": {
          "type": "string",
          "format": "date",
          "description": "Срок выполнения"
        },
        "status": {
          "type": "string",
          "enum": ["new", "in_progress", "review", "done", "cancelled"],
          "description": "Статус задачи"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Теги для классификации задачи"
        },
        "subtasks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "title": { "type": "string" },
              "completed": { "type": "boolean" }
            }
          },
          "description": "Подзадачи"
        }
      }
    },
    "incidentContext": {
      "type": "object",
      "required": ["type", "title", "description", "severity"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["incident"],
          "description": "Тип контекста - инцидент"
        },
        "title": {
          "type": "string",
          "description": "Название инцидента"
        },
        "description": {
          "type": "string",
          "description": "Подробное описание инцидента"
        },
        "severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "Серьезность инцидента"
        },
        "category": {
          "type": "string",
          "enum": ["process", "system", "communication", "infrastructure", "security", "other"],
          "description": "Категория инцидента"
        },
        "assignee": {
          "type": "string",
          "description": "Ответственный за устранение"
        },
        "status": {
          "type": "string",
          "enum": ["new", "investigating", "fixing", "resolved", "closed"],
          "description": "Статус инцидента"
        },
        "detection_time": {
          "type": "string",
          "format": "date-time",
          "description": "Время обнаружения инцидента"
        },
        "resolution_time": {
          "type": "string",
          "format": "date-time",
          "description": "Время разрешения инцидента"
        },
        "root_cause": {
          "type": "string",
          "description": "Корневая причина инцидента"
        },
        "impact": {
          "type": "string",
          "description": "Влияние инцидента на проект/продукт"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Теги для классификации инцидента"
        }
      }
    },
    "genericContext": {
      "type": "object",
      "description": "Общий формат контекста для нестандартных случаев",
      "additionalProperties": true
    }
  },
  "examples": [
    {
      "project": "heroes.camp",
      "namespace": "meetings",
      "version": "1.0",
      "source": "slack",
      "timestamp": "2025-05-15T14:30:00Z",
      "data": {
        "type": "meeting",
        "title": "Еженедельный созвон с клиентом",
        "date": "2025-05-15T13:00:00Z",
        "duration": 60,
        "participants": [
          {
            "name": "Илья Красинский",
            "role": "Product Owner",
            "company": "Heroes"
          },
          {
            "name": "Александр Петров",
            "role": "CEO",
            "company": "Client Company"
          }
        ],
        "summary": "Обсудили прогресс разработки, клиент доволен результатами. Зафиксировали приоритеты на следующую неделю.",
        "decisions": [
          "Фокус на улучшение конверсии в разделе регистрации",
          "Отложить запуск новых функций до следующего релиза"
        ],
        "action_items": [
          {
            "description": "Подготовить макеты нового процесса регистрации",
            "assignee": "Дизайнер",
            "due_date": "2025-05-20"
          },
          {
            "description": "Проанализировать данные о конверсии за последний месяц",
            "assignee": "Аналитик",
            "due_date": "2025-05-18"
          }
        ]
      }
    },
    {
      "project": "rick.ai",
      "namespace": "client_feedback",
      "version": "1.0",
      "source": "telegram",
      "timestamp": "2025-05-15T16:45:00Z",
      "data": {
        "type": "client_feedback",
        "client": {
          "name": "Иван Сидоров",
          "company": "TechCorp",
          "contact": "ivan@example.com"
        },
        "feedback": "Очень доволен новым дизайном дашборда. Интуитивно понятно, быстро загружается. Но есть проблема с отображением графиков на мобильных устройствах.",
        "rating": 8,
        "sentiment": "positive",
        "areas": ["design", "usability", "mobile"],
        "suggestions": [
          "Улучшить адаптивность графиков для мобильных экранов",
          "Добавить возможность скачивать отчеты в формате PDF"
        ]
      }
    }
  ]
}