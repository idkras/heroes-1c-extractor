<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advising Diagnostics API Test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        pre {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            max-height: 500px;
            overflow: auto;
        }
        .api-key-container {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .endpoint-card {
            margin-bottom: 15px;
            border-left: 4px solid #0d6efd;
        }
        .response-container {
            margin-top: 20px;
        }
        .nav-tabs {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Advising Diagnostics API Test</h1>
        <p class="lead">Используйте эту страницу для тестирования API стандартов и проектов</p>

        <div class="api-key-container mb-3">
            <label for="apiKey" class="form-label">API Key</label>
            <div class="input-group">
                <input type="text" class="form-control" id="apiKey" value="advising-diagnostics-api-key">
                <button class="btn btn-outline-secondary" type="button" id="saveApiKey">Сохранить</button>
            </div>
            <div class="form-text">API-ключ используется для авторизации запросов</div>
        </div>

        <ul class="nav nav-tabs" id="apiTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="standards-tab" data-bs-toggle="tab" data-bs-target="#standards" type="button" role="tab">Стандарты</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="projects-tab" data-bs-toggle="tab" data-bs-target="#projects" type="button" role="tab">Проекты</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#file" type="button" role="tab">Файл</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="search-tab" data-bs-toggle="tab" data-bs-target="#search" type="button" role="tab">Поиск</button>
            </li>
        </ul>

        <div class="tab-content" id="apiTabsContent">
            <!-- Стандарты -->
            <div class="tab-pane fade show active" id="standards" role="tabpanel">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Получить список стандартов</h5>
                        <p class="card-text">Endpoint: <code>/api/standards</code></p>
                        <button id="getStandards" class="btn btn-primary">Выполнить запрос</button>
                    </div>
                </div>
                <div class="response-container" id="standardsResponse">
                    <h6>Ответ:</h6>
                    <pre id="standardsResponseContent"></pre>
                </div>
            </div>

            <!-- Проекты -->
            <div class="tab-pane fade" id="projects" role="tabpanel">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Получить список проектов</h5>
                        <p class="card-text">Endpoint: <code>/api/projects</code></p>
                        <button id="getProjects" class="btn btn-primary">Выполнить запрос</button>
                    </div>
                </div>
                <div class="response-container" id="projectsResponse">
                    <h6>Ответ:</h6>
                    <pre id="projectsResponseContent"></pre>
                </div>
            </div>

            <!-- Файл -->
            <div class="tab-pane fade" id="file" role="tabpanel">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Получить содержимое файла</h5>
                        <p class="card-text">Endpoint: <code>/api/file/{path}</code></p>
                        <div class="mb-3">
                            <label for="filePathInput" class="form-label">Путь к файлу</label>
                            <input type="text" class="form-control" id="filePathInput" placeholder="Например: Advising Standards/advising diagnostics standard.md">
                        </div>
                        <button id="getFile" class="btn btn-primary">Выполнить запрос</button>
                    </div>
                </div>
                <div class="response-container" id="fileResponse">
                    <h6>Ответ:</h6>
                    <pre id="fileResponseContent"></pre>
                </div>
            </div>

            <!-- Поиск -->
            <div class="tab-pane fade" id="search" role="tabpanel">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Поиск по файлам</h5>
                        <p class="card-text">Endpoint: <code>/api/search?q={query}</code></p>
                        <div class="mb-3">
                            <label for="searchQueryInput" class="form-label">Поисковый запрос</label>
                            <input type="text" class="form-control" id="searchQueryInput" placeholder="Например: диагностика">
                        </div>
                        <button id="executeSearch" class="btn btn-primary">Выполнить запрос</button>
                    </div>
                </div>
                <div class="response-container" id="searchResponse">
                    <h6>Ответ:</h6>
                    <pre id="searchResponseContent"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Сохраняем API-ключ
            const apiKeyInput = document.getElementById('apiKey');
            const saveApiKeyBtn = document.getElementById('saveApiKey');
            
            // Загружаем сохраненный API-ключ
            if (localStorage.getItem('advising_api_key')) {
                apiKeyInput.value = localStorage.getItem('advising_api_key');
            }
            
            saveApiKeyBtn.addEventListener('click', function() {
                localStorage.setItem('advising_api_key', apiKeyInput.value);
                alert('API-ключ сохранен');
            });

            // Функция для выполнения API-запроса
            async function makeApiRequest(endpoint, params = {}) {
                const apiKey = apiKeyInput.value;
                // Используем порт 5001 для API
                let url = 'http://localhost:5001' + endpoint;
                
                // Добавляем параметры к URL
                if (Object.keys(params).length > 0) {
                    const queryString = Object.keys(params)
                        .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                        .join('&');
                    url = `${endpoint}?${queryString}`;
                }
                
                try {
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'X-API-Key': apiKey
                        }
                    });
                    
                    const data = await response.json();
                    return {
                        status: response.status,
                        data: data
                    };
                } catch (error) {
                    return {
                        status: 500,
                        data: { error: error.message }
                    };
                }
            }

            // Функция для отображения ответа
            function displayResponse(containerId, response) {
                const container = document.getElementById(containerId);
                const content = JSON.stringify(response, null, 2);
                container.textContent = content;
            }

            // Получение списка стандартов
            const getStandardsBtn = document.getElementById('getStandards');
            getStandardsBtn.addEventListener('click', async function() {
                const response = await makeApiRequest('/api/standards');
                displayResponse('standardsResponseContent', response);
            });

            // Получение списка проектов
            const getProjectsBtn = document.getElementById('getProjects');
            getProjectsBtn.addEventListener('click', async function() {
                const response = await makeApiRequest('/api/projects');
                displayResponse('projectsResponseContent', response);
            });

            // Получение содержимого файла
            const getFileBtn = document.getElementById('getFile');
            getFileBtn.addEventListener('click', async function() {
                const filePath = document.getElementById('filePathInput').value;
                if (!filePath) {
                    alert('Укажите путь к файлу');
                    return;
                }
                const response = await makeApiRequest(`/api/file/${encodeURIComponent(filePath)}`);
                displayResponse('fileResponseContent', response);
            });

            // Поиск по файлам
            const executeSearchBtn = document.getElementById('executeSearch');
            executeSearchBtn.addEventListener('click', async function() {
                const query = document.getElementById('searchQueryInput').value;
                if (!query) {
                    alert('Введите поисковый запрос');
                    return;
                }
                const response = await makeApiRequest('/api/search', { q: query });
                displayResponse('searchResponseContent', response);
            });
        });
    </script>
</body>
</html>