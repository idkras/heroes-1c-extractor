#!/usr/bin/env python3
"""
Тест для проверки триггера при создании инцидента с 5-почему.
"""

import logging

# Настройка логирования
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler("incident_trigger_test.log"),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger("incident_trigger_test")

# Импортируем унифицированный интерфейс документов
from document_unified_interface import IncidentDocument

def test_incident_trigger():
    """Тестирует вывод триггера при создании инцидента с 5-почему."""
    logger.info("=== Тест триггера создания инцидента ===")
    
    incident_doc = IncidentDocument()
    incident_id = incident_doc.create(
        title="Комплексная проверка вывода триггеров для инцидента",
        description="""
## Описание инцидента
Проверка полноты вывода триггера при создании инцидента, включая анализ 5-почему.

## Анализ 5-почему

### Почему #1: Почему необходимо проверять полноту вывода триггеров?
Потому что триггеры должны предоставлять всю необходимую информацию пользователю сразу после создания документа.

### Почему #2: Почему важно предоставлять всю информацию сразу?
Потому что это повышает удобство использования системы и позволяет быстрее принимать решения.

### Почему #3: Почему быстрое принятие решений важно?
Потому что это экономит время пользователя и повышает эффективность работы с системой.

### Почему #4: Почему эффективность работы с системой критична?
Потому что конечная цель системы - помогать пользователю выполнять задачи, а не создавать дополнительные препятствия.

### Почему #5: Почему важно не создавать препятствия?
Потому что система должна быть инструментом, а не проблемой, которую нужно решать.

## Корневая причина
Необходимость полноценного вывода информации в триггерах обусловлена потребностью в эффективном и удобном интерфейсе, который помогает пользователю, а не мешает ему.

## Решение
Проверить и доработать систему триггеров так, чтобы она выводила всю необходимую информацию в понятном и удобном формате.
        """
    )
    
    logger.info(f"Создан тестовый инцидент с ID: {incident_id}")
    print(f"\n[✓] Создан инцидент: Комплексная проверка вывода триггеров для инцидента (ID: {incident_id})")
    print(f"[✓] Проверьте вывод 5-почему анализа в чат!")
    print(f"[✓] Ожидаемый URL: http://0.0.0.0:5000/incidents/Комплексная-проверка-вывода-триггеров-для-инцидента")

if __name__ == "__main__":
    test_incident_trigger()